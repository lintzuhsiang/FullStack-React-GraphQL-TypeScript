var e=require("./1cc90026.min.js");function n(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.onsuccess=function(){n(e.result)}}))}function t(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.oncomplete=n}))}exports.makeDefaultStorage=function(r){r||(r={});var o=r.idbName||"graphcache-v4",u="entries",c="metadata",a=Object.create(null),i=Math.floor((new Date).valueOf()/864e5),f=i-(r.maxAge||7),s=indexedDB.open(o,1),l=n(s);function d(e){return e.replace(/:/g,"%3a")}function v(e){return e.replace(/%3a/g,":")}function h(e){for(var n={},t="",r="",o="",u=0,c=0;c<e.length;){for(o="";":"!==(t=e[c++])&&t;)o+=t;u?(n[r]=v(o)||void 0,u=0):(r=v(o),u=1)}return n}return s.onupgradeneeded=function(){s.result.createObjectStore(u),s.result.createObjectStore(c)},{clear:function(){return l.then((function(e){var n=e.transaction([c,u],"readwrite");return n.objectStore(c).clear(),n.objectStore(u).clear(),t(n)}))},readMetadata:function(){return l.then((function(e){return n(e.transaction(c,"readonly").objectStore(c).get(c))}),(function(){return null}))},writeMetadata:function(e){l.then((function(t){return n(t.transaction(c,"readwrite").objectStore(c).put(e,c))}),(function(){}))},writeData:function(t){e._extends(a,t);var r=function(){};return l.then((function(e){return n(e.transaction(u,"readwrite").objectStore(u).put(function(){var e="";for(var n in a){var t=a[n];e+=d(n),e+=":",t&&(e+=d(t)),e+=":"}return e}(),i))})).then(r,r)},readData:function(){var n=[];return l.then((function(r){var o=r.transaction(u,"readwrite"),c=o.objectStore(u);return(c.openKeyCursor||c.openCursor).call(c).onsuccess=function(){if(this.result){var t=this.result.key;if("number"!=typeof t||t<f)c.delete(t);else{var r=c.get(t),o=n.length;n.push(""),r.onsuccess=function(){var u=""+r.result;t===i&&e._extends(a,h(u)),n[o]=u}}this.result.continue()}},t(o)})).then((function(){return h(n.join(""))}),(function(){return a}))},onOnline:function(e){window.addEventListener("online",(function(){e()}))}}};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.js.map
