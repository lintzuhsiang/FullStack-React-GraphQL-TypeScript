import{_ as n}from"./08e6d3e1.min.mjs";function e(n){return new Promise((function(e,t){n.onerror=function(){t(n.error)},n.onsuccess=function(){e(n.result)}}))}function t(n){return new Promise((function(e,t){n.onerror=function(){t(n.error)},n.oncomplete=e}))}function r(r){r||(r={});var o=r.idbName||"graphcache-v4",u="entries",c="metadata",a=Object.create(null),i=Math.floor((new Date).valueOf()/864e5),f=i-(r.maxAge||7),s=indexedDB.open(o,1),l=e(s);function d(n){return n.replace(/:/g,"%3a")}function h(n){return n.replace(/%3a/g,":")}function v(n){for(var e={},t="",r="",o="",u=0,c=0;c<n.length;){for(o="";":"!==(t=n[c++])&&t;)o+=t;u?(e[r]=h(o)||void 0,u=0):(r=h(o),u=1)}return e}return s.onupgradeneeded=function(){s.result.createObjectStore(u),s.result.createObjectStore(c)},{clear:function(){return l.then((function(n){var e=n.transaction([c,u],"readwrite");return e.objectStore(c).clear(),e.objectStore(u).clear(),t(e)}))},readMetadata:function(){return l.then((function(n){return e(n.transaction(c,"readonly").objectStore(c).get(c))}),(function(){return null}))},writeMetadata:function(n){l.then((function(t){return e(t.transaction(c,"readwrite").objectStore(c).put(n,c))}),(function(){}))},writeData:function(t){n(a,t);var r=function(){};return l.then((function(n){return e(n.transaction(u,"readwrite").objectStore(u).put(function(){var n="";for(var e in a){var t=a[e];n+=d(e),n+=":",t&&(n+=d(t)),n+=":"}return n}(),i))})).then(r,r)},readData:function(){var e=[];return l.then((function(r){var o=r.transaction(u,"readwrite"),c=o.objectStore(u);return(c.openKeyCursor||c.openCursor).call(c).onsuccess=function(){if(this.result){var t=this.result.key;if("number"!=typeof t||t<f)c.delete(t);else{var r=c.get(t),o=e.length;e.push(""),r.onsuccess=function(){var u=""+r.result;t===i&&n(a,v(u)),e[o]=u}}this.result.continue()}},t(o)})).then((function(){return v(e.join(""))}),(function(){return a}))},onOnline:function(n){window.addEventListener("online",(function(){n()}))}}}export{r as makeDefaultStorage};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.mjs.map
